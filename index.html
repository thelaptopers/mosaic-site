<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Mosaic Portrait</title>

<script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

<style>

body{
margin:0;
background:#0f0f0f;
font-family:Arial;
color:white;
text-align:center;
}

.container{
max-width:900px;
margin:auto;
padding:30px;
}

button{
padding:12px 18px;
border:none;
background:#4c6fff;
color:white;
border-radius:8px;
cursor:pointer;
margin-top:10px;
}

canvas{
margin-top:20px;
max-width:100%;
background:white;
}

</style>
</head>

<body>

<div class="container">

<h1>Portrait Mosaic Generator</h1>

<input type="file" id="upload">

<br>

<button onclick="generate()">Generate Portrait</button>
<button onclick="download()">Download</button>

<br>

<canvas id="canvas"></canvas>

</div>

<script>

const canvas = document.getElementById("canvas")
const ctx = canvas.getContext("2d")

async function generate(){

const file = document.getElementById("upload").files[0]
if(!file) return

await faceapi.nets.tinyFaceDetector.loadFromUri("https://justadudewhohacks.github.io/face-api.js/models")

const img = new Image()
img.src = URL.createObjectURL(file)

img.onload = async function(){

const detection = await faceapi.detectSingleFace(img,new faceapi.TinyFaceDetectorOptions())

if(!detection){
alert("Face not detected")
return
}

const box = detection.box

const size = 2
const resolution = 1600

canvas.width = resolution
canvas.height = resolution

ctx.drawImage(
img,
box.x,box.y,box.width,box.height,
0,0,resolution,resolution
)

for(let y=0;y<resolution;y+=size){
for(let x=0;x<resolution;x+=size){

let p = ctx.getImageData(x,y,1,1).data
let gray = (p[0]+p[1]+p[2])/3

let color = gray>120 ? 255 : 0

ctx.fillStyle = `rgb(${color},${color},${color})`
ctx.fillRect(x,y,size,size)

}

}

}

}

function download(){

const link = document.createElement("a")
link.download = "portrait.png"
link.href = canvas.toDataURL()
link.click()

}

</script>

</body>
</html>
